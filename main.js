(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{f:()=>j,ED:()=>A,rC:()=>x});var t,n=function(e,t){!function(e){return!e.every((function(e){return e.validity.valid}))}(e)?t.removeAttribute("disabled","disabled"):t.setAttribute("disabled","disabled")};function r(e){e.classList.add("popup_opened"),document.addEventListener("keydown",u),document.addEventListener("click",c)}function o(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",u),document.removeEventListener("click",c)}function u(e){"Escape"===e.key&&o(document.querySelector(".popup_opened"))}function c(e){e.target.classList.contains("popup")&&o(document.querySelector(".popup_opened"))}var l={baseUrl:"https://nomoreparties.co/v1/exp-mipt-fbc-1/",headers:{authorization:"bc241b34-9853-4740-a621-84c50218ff40","Content-Type":"application/json"}};function i(e,t){return fetch(e,{headers:l.headers,method:t}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}function a(e,t,n){return fetch(e,{headers:l.headers,method:t,body:n}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}var s=document.querySelector(".image-popup"),d=document.querySelector(".element-list"),p=document.getElementById("element-list__card-template");function m(e){d.prepend(e)}function f(e){var n,o,u,c,a,d,m,f,_=p.content.querySelector(".element-list__card").cloneNode(!0);return _.querySelector(".element-list__image").src=e.link,_.querySelector(".element-list__image").alt=e.name,_.querySelector(".element-list__text").textContent=e.name,_.querySelector(".element-list__like-counter").textContent=e.likes.length,Array.from(JSON.parse(JSON.stringify(e.likes))).map((function(e){return e._id})),e.likes.map((function(e){return e._id})).some((function(e){return e===t}))&&_.querySelector(".element-list__like-button").classList.toggle("element-list__like-button_liked"),n=_,o=e.name,u=e.url,c=e.owner._id===t,a=e._id,d=n.querySelector(".element-list__like-button"),m=n.querySelector(".element-list__trash-button"),f=n.querySelector(".element-list__image"),d.addEventListener("click",(function(){!function(e,t){var n=t.querySelector(".element-list__like-counter"),r=t.querySelector(".element-list__like-button").classList.contains("element-list__like-button_liked");i(l.baseUrl+"cards/likes/"+e,r?"DELETE":"PUT").then((function(e){t.querySelector(".element-list__like-button").classList.toggle("element-list__like-button_liked"),n.textContent=e.likes.length}))}(a,n)})),c?m.addEventListener("click",(function(){var e;n.remove(),e=a,i(l.baseUrl+"cards/"+e,"DELETE").catch((function(e){console.log(e)}))})):(m.classList.add("button_hidden"),m.disabled=!0),f.addEventListener("click",(function(){r(s),s.querySelector(".popup__image").src=u,s.querySelector(".popup__text").textContent=o})),_}var _,v=document.querySelector(".profile__edit-button"),y=document.querySelector(".profile__add-button"),S=document.querySelectorAll(".popup__close-button"),b=document.querySelector(".rename-popup"),q=document.querySelector(".add-popup"),h=b.querySelector(".form"),k=q.querySelector(".form"),E=h.querySelector('input[name="username"]'),g=h.querySelector('input[name="userjob"]'),C=k.querySelector('input[name="picturename"]'),L=k.querySelector('input[name="picturelink"]'),x=document.querySelector(".profile__name"),A=document.querySelector(".profile__quote"),O=document.querySelector(".edit-popup"),T=document.querySelector(".profile__avatar-edit"),U=O.querySelector(".form"),j=document.querySelector(".profile__avatar"),P=U.querySelector('input[name="avatalink"]'),D=b.querySelector(".popup__save-button"),N=q.querySelector(".popup__save-button"),J=O.querySelector(".popup__save-button");v.addEventListener("click",(function(){r(b),E.value=x.textContent,g.value=A.textContent})),y.addEventListener("click",(function(){r(q)})),T.addEventListener("click",(function(){r(O)})),S.forEach((function(e){var t=e.closest(".popup");e.addEventListener("click",(function(){return o(t)}))})),h.addEventListener("submit",(function(e){var t,n;e.preventDefault(),x.textContent=E.value,A.textContent=g.value,D.textContent="Сохраняется",(t=E.value,n=g.value,a(l.baseUrl+"users/me","PATCH",JSON.stringify({name:t,about:n}))).catch((function(e){console.log(e)})).finally((function(){D.textContent="Сохранить"})),e.target.reset(),o(b)})),k.addEventListener("submit",(function(e){var t,n;e.preventDefault(),N.textContent="Сохраняется",(t=C.value,n=L.value,a(l.baseUrl+"cards/","POST",JSON.stringify({name:t,link:n})).then((function(e){m(f(e))}))).then((function(){C.value="",L.value="",e.target.reset(),q.querySelector(".popup__save-button").setAttribute("disabled","disabled"),o(q)})).catch((function(e){console.log(e)})).finally((function(){N.textContent="Создать"}))})),U.addEventListener("submit",(function(e){var t;e.preventDefault(),J.textContent="Сохраняется",(t=P.value,a(l.baseUrl+"users/me/avatar","PATCH",JSON.stringify({avatar:t})).then((function(){j.src=t})).catch((function(e){console.log(e)}))).finally((function(){J.textContent="Сохранить"})),e.target.reset(),o(O)})),_={formSelector:".form",inputSelector:".popup__input",submitButtonSelector:".popup__save-button",inputErrorClass:"popup__input_error",errorClass:"popup__input-error_visible"},Array.from(document.querySelectorAll(_.formSelector)).forEach((function(e){!function(e,t){var r=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n(r,o),r.forEach((function(u){u.addEventListener("input",(function(){n(r,o),function(e,t,n){t.validity.valid?function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""}(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(e,t,t.validationMessage,n)}(e,u,t)}))}))}(e,_)})),i(l.baseUrl+"users/me","GET").then((function(e){j.src=e.avatar,x.textContent=e.name,A.textContent=e.about,t=e._id})).catch((function(e){console.log("An error has occured",e)})),i(l.baseUrl+"cards","GET").then((function(e){var t;t=e,console.log("inrend"),Array.from(t).forEach((function(e){m(f(e))}))})).catch((function(e){console.log(e)}))})();